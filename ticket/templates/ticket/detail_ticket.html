{% extends 'base_templates/base.html' %}

{% block title %}Log in{% endblock title %}

{% block content %}
  <div class="container mb-5 pb-5">
    <div class="row justify-content-center mt-5">
      <div class="col-md-8">
        <div class="card bg-secondary">
          <div class="card-header">
            <h1 class="text-center">Ticket id: {{ ticket.pk }}</h1>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item bg-secondary bg-dark text-light form-control"><h5>User:</h5> {{ ticket.user }}</li>
              <li class="list-group-item bg-secondary bg-dark text-light form-control"><h5>Priority:</h5> {{ ticket.priority }}</li>
              <li class="list-group-item bg-secondary bg-dark text-light form-control"><h5>Status:</h5> {{ ticket.status }}</li>
              <li class="list-group-item bg-secondary bg-dark text-light form-control"><h5>Subject:</h5> {{ ticket.subject }}</li>
              <li class="list-group-item bg-secondary bg-dark text-light form-control"><h5>Description:</h5> {{ ticket.description }}</li>
              <form action="{% url 'update_ticket' pk=ticket.pk %}">
                <button type="submit" class="btn btn-primary mt-3 mb-3">Update Ticket</button>
              </form>
              {% for com in ticket.get_comments %}
              <li class="list-group-item bg-dark text-light form-control"><h4>
                {% if user == com.author %}
                You
                {% else %}
                {{ com.author }}
                {% endif %}
                :</h4> {{ com.text }}</li>
              {% endfor %}

              {% if ticket.status == 'In progress' %}
              <form method="POST" action="{% url 'comment_create' pk=ticket.pk %}">
                {% csrf_token %}
                <div class="form-group mt-3">
                  <label for="comment-text">Коментар:</label>
                  <textarea class="form-control bg-dark text-light" id="comment-text" rows="3" name="comment_text" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Додати коментар</button>
              </form>

              {% endif %}

              {% if ticket.status == 'Rejected' %}
              <form method="POST" action="{% url 'ticket_restore' pk=ticket.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary mt-3">Restore</button>
              </form>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}